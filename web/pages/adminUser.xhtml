<?xml version="1.0" encoding="UTF-8"?>
<!--
  Created by IntelliJ IDEA.
  User: mary
  Date: 14/07/2023
  Time: 16:19
-->
<!DOCTYPE html
        PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets">


<h:head>
    <title>Gestionar Uusarios</title>
</h:head>

<h:body>
    <ui:composition template="template.xhtml">
    <ui:define name="title"> Gestionar Usuarios</ui:define>
    <ui:define name="content">
    #{referenceManagerBean.initUserTable()}
    <h:form id="form">
    <p:growl id="messages" showDetail="true"/>
        <div>
            <p:toolbar>
                <p:toolbarGroup align="left">
                    <p:commandButton value="Registar" icon="pi pi-plus" style="margin-right: .5rem" process="@this" actionListener="#{referenceManagerBean.userBean.cleanVariables()}"
                                     oncomplete="PF('addUserDialog').show()"/>
                    <p:commandButton value="Eliminar" icon="pi pi-trash" styleClass="ui-button-help" process="dt-user" oncomplete="PF('deleteUserListDialog').show()"/>
                </p:toolbarGroup>
            </p:toolbar>
        </div>
        <div class="card">
            <p:dataTable tableStyleClass="table-striped" id="dt-user" var="user" value="#{referenceManagerBean.userBean.userList}"
                         selection="#{referenceManagerBean.userBean.selectUserList}" rowKey="#{user.id}"
                         style="margin-bottom:0" paginator="true" rows="5" selectionPageOnly="false">

                <p:column selectionMode="multiple" style="width:16px;text-align:center"/>

                <p:column headerText="Nombre de Usuario" filterBy="#{user.username}" sortBy="#{user.username}">
                    <h:outputText value="#{user.username}" />
                </p:column>

                <p:column headerText="E-mail" filterBy="#{user.email}" sortBy="#{user.email}">
                    <h:outputText value="#{user.email}" />
                </p:column>

                <p:column headerText="Nombre" filterBy="#{user.name}" sortBy="#{user.name}">
                    <h:outputText value="#{user.name}" />
                </p:column>

                <p:column headerText="Apellido" filterBy="#{user.lastName}" sortBy="#{user.lastName}">
                    <h:outputText value="#{user.lastName}" />
                </p:column>

                <p:column headerText="Estado" filterBy="#{referenceManagerBean.userBean.translateEstado(user.enabled)}"
                          sortBy="#{referenceManagerBean.userBean.translateEstado(user.enabled)}">
                    <h:outputLabel style="color: #{referenceManagerBean.userBean.translateColorEstado(user.enabled)}"
                                   value="#{referenceManagerBean.userBean.translateEstado(user.enabled)}"/>
                </p:column>

                <p:column headerText="Opciones" exportable="false">
                    <p:commandButton icon="pi pi-info" update=":form:info-user-content" process="@this"
                                     oncomplete="PF('infoUserDialog').show()" actionListener="#{referenceManagerBean.userBean.copyEdit(user)}"
                                     styleClass="info-button rounded-button ui-button-text-icon-primary">
                    </p:commandButton>

                    <p:commandButton icon="pi pi-pencil" update=":form:edit-user-content" process="@this"
                                     oncomplete="PF('editUserDialog').show()"  styleClass="edit-button rounded-button ui-button-secondary"
                                     actionListener="#{referenceManagerBean.userBean.copyEdit(user)}">
                    </p:commandButton>

                    <p:commandButton class="ui-button-primary rounded-button" icon="pi pi-trash"
                                     oncomplete="PF('deleteUserDialog').show()" process="@this" >
                        <f:setPropertyActionListener value="#{user}" target="#{referenceManagerBean.userBean.user}" />
                    </p:commandButton>
                </p:column>
            </p:dataTable>
        </div>

        <!--Add User dialog-->
        <p:dialog header="Crear Usuario" height="400" width="450" showEffect="fade" modal="true"
                  widgetVar="addUserDialog"
                  id="addUserDialog" resposive="true">
            <p:outputPanel id="manage-user-content" class="ui-fluid">
                #{referenceManagerBean.userBean.cleanVariables()}
                <p:outputPanel>
                    <div class="p-field">
                        <p:outputLabel for="username">Nombre de Usuario</p:outputLabel>
                        <p:inputText id="username" value="#{referenceManagerBean.userBean.username}" required="true">
                            <f:validateRegex pattern="[a-z]+[0-9]*[_.-]?[a-z0-9]+$"/>
                        </p:inputText>
                    </div>

                    <div class="p-field">
                        <p:outputLabel for="email">E-mail</p:outputLabel>
                        <p:inputText id="email" value="#{referenceManagerBean.userBean.email}" required="true">
                            <f:validateRegex pattern="[\w\.-]*[a-zA-Z8-9_]@[\w\.-]*[a-zA-Z8-9]\.[a-zA-Z][a-zA-Z\.]*[a-zA-Z]+$"/>
                        </p:inputText>
                    </div>

                    <div class="p-field">
                        <p:outputLabel for="password">Contraseña</p:outputLabel>
                        <p:password id="password" value="#{referenceManagerBean.userBean.password}" feedback="true" required="true"
                                    promptLabel="Ingresa tu contraseña" weakLabel="Debil" goodLabel="Buena" strongLabel="Fuerte"/>
                    </div>

                    <div class="p-field">
                        <p:outputLabel for="name">Nombre</p:outputLabel>
                        <p:inputText id="name" value="#{referenceManagerBean.userBean.name}" required="true">
                            <f:validateRegex pattern="[a-zA-Z áéíóúüñÁÉÍÓÚÜÑ]+$"/>
                        </p:inputText>
                    </div>

                    <div class="p-field">
                        <p:outputLabel for="lastName">Apellido</p:outputLabel>
                        <p:inputText id="lastName" value="#{referenceManagerBean.userBean.lastName}" required="true">
                            <f:validateRegex pattern="[a-zA-Z áéíóúüñÁÉÍÓÚÜÑ]+$"/>
                        </p:inputText>
                    </div>

                    <div class="p-field">
                        <p:outputLabel for="enabled">Estado</p:outputLabel>
                        <p:selectOneRadio id="enabled" value="#{referenceManagerBean.userBean.enabled}" required="true" layout="responsive" columns="2">
                            <f:selectItem itemLabel="Habilitado" itemValue="true"/>
                            <f:selectItem itemLabel="Deshabilitado" itemValue="false"/>
                        </p:selectOneRadio>
                    </div>

                    <div class="p-field">
                        <p:outputLabel for="roles">Roles del Usuario</p:outputLabel>
                        <p:selectManyMenu requiredMessage="Roles: Se requiere al menos un Rol" required="true"
                                          showCheckbox="true"  label="Roles" id="roles" value="#{referenceManagerBean.userBean.roles}">
                            <f:selectItem itemLabel="Administrador" itemValue="ROLE_ADMIN"/>
                            <f:selectItem itemLabel="Usuario" itemValue="ROLE_USER"/>
                            <f:selectItem itemLabel="Gerente" itemValue="ROLE_MANAGER"/>
                            <f:selectItem itemLabel="Auditor" itemValue="ROLE_AUDITOR"/>
                        </p:selectManyMenu>
                    </div>


                </p:outputPanel>
            </p:outputPanel>

            <f:facet name="footer">
                <p:commandButton value="Guardar" icon="pi pi-check"
                                 actionListener="#{referenceManagerBean.createUser}"
                                 update="manage-user-content" process="manage-user-content @this"/>
                <p:commandButton value="Cancelar" icon="pi pi-times" onclick="PF('addUserDialog').hide()"
                                 class="ui-button-secondary"/>
            </f:facet>
        </p:dialog>

        <!--Delete dialog-->
        <p:confirmDialog widgetVar="deleteUserDialog" showEffect="fade" width="300"
                         message="Eliminar el usuario"
                         header="Confirmar" severity="warn">
            <p:commandButton value="Sí" icon="ui-icon-check" actionListener="#{referenceManagerBean.deleteUser}"
                             process="@this" oncomplete="PF('deleteUserDialog').hide()"/>
            <p:commandButton value="No" type="button" styleClass="ui-button-secondary" icon="ui-icon-times"
                             onclick="PF('deleteUserDialog').hide()"/>
        </p:confirmDialog>
        <p:confirmDialog global="true" showEffect="fade" width="300">
            <p:commandButton value="Sí" type="button" styleClass="ui-confirmdialog-yes" icon="ui-icon-check"/>
            <p:commandButton value="No" type="button" styleClass="ui-confirmdialog-no ui-button-secondary"
                             icon="ui-icon-times"/>
        </p:confirmDialog>

        <!--Delete list dialog-->
        <p:confirmDialog widgetVar="deleteUserListDialog" showEffect="fade" width="300"
                         message="Eliminar el conjunto de usuarios seleccionados"
                         header="Confirmar" severity="warn">
            <p:commandButton value="Sí" icon="ui-icon-check" actionListener="#{referenceManagerBean.deleteSelectedUser}"
                             process="@this" oncomplete="PF('deleteUserListDialog').hide()"/>
            <p:commandButton value="No" type="button" styleClass="ui-button-secondary" icon="ui-icon-times"
                             onclick="PF('deleteUserDialog').hide()"/>
        </p:confirmDialog>
        <p:confirmDialog global="true" showEffect="fade" width="300">
            <p:commandButton value="Sí" type="button" styleClass="ui-confirmdialog-yes" icon="ui-icon-check"/>
            <p:commandButton value="No" type="button" styleClass="ui-confirmdialog-no ui-button-secondary"
                             icon="ui-icon-times"/>
        </p:confirmDialog>

        <!--Info User dialog-->
        <p:dialog header="Información del usuario" height="400" width="700" showEffect="fade" modal="true"
                  widgetVar="infoUserDialog"
                  id="infoUserDialog" resposive="true">
            <p:outputPanel id="info-user-content" class="ui-fluid">
                <p:outputPanel>
                    <div class="p-field">
                        <strong>Nombre de usuario: </strong>
                        <p:outputLabel>#{referenceManagerBean.userBean.user.username}</p:outputLabel>
                    </div>

                    <div class="p-field">
                        <strong>E-mail: </strong>
                        <p:outputLabel>#{referenceManagerBean.userBean.user.email}</p:outputLabel>
                    </div>

                    <div class="p-field">
                        <strong>Contraseña: </strong>
                        <p:outputLabel>#{referenceManagerBean.userBean.user.password}</p:outputLabel>
                    </div>

                    <div class="p-field">
                        <strong>Nombre: </strong>
                        <p:outputLabel>#{referenceManagerBean.userBean.user.name}</p:outputLabel>
                    </div>

                    <div class="p-field">
                        <strong>Apellido: </strong>
                        <p:outputLabel>#{referenceManagerBean.userBean.user.lastName}</p:outputLabel>
                    </div>

                    <div class="p-field">
                        <strong>Estado: </strong>
                        <p:outputLabel style="color: #{referenceManagerBean.userBean.translateColorEstado(referenceManagerBean.userBean.user.enabled)}">
                        #{referenceManagerBean.userBean.translateEstado(referenceManagerBean.userBean.user.enabled)}
                        </p:outputLabel>
                    </div>

                    <div class="p-field">
                        <strong>Roles del Usuario: </strong>
                        <p:orderList value="#{referenceManagerBean.userBean.roleInfo()}" var="role" controlsLocation="none" itemLabel="#{role}" itemValue="#{role}"/>
                    </div>

                </p:outputPanel>
            </p:outputPanel>
            <f:facet name="footer">
                <p:commandButton value="Cerrar" icon="pi pi-times" onclick="PF('infoUserDialog').hide()"
                                 class="ui-button-secondary" update="info-user-content"
                                 process="info-user-content @this"/>
            </f:facet>
        </p:dialog>

        <!--Edit User dialog-->
        <p:dialog header="Editar el usuario" height="400" width="450" showEffect="fade" modal="true"
                  widgetVar="editUserDialog" id="editUserDialog" resposive="true">
            <p:outputPanel id="edit-user-content" class="ui-fluid">
                <p:outputPanel>
                    <div class="p-field">
                        <p:outputLabel for="usernameE">Nombre de Usuario</p:outputLabel>
                        <p:inputText id="usernameE" value="#{referenceManagerBean.userBean.user.username}" required="true">
                            <f:validateRegex pattern="[a-z]+[0-9]*[_.-]?[a-z0-9]+$"/>"
                        </p:inputText>
                    </div>

                    <div class="p-field">
                        <p:outputLabel for="emailE">E-mail</p:outputLabel>
                        <p:inputText id="emailE" value="#{referenceManagerBean.userBean.user.email}" required="true">
                            <f:validateRegex pattern="[\w\.-]*[a-zA-Z8-9_]@[\w\.-]*[a-zA-Z8-9]\.[a-zA-Z][a-zA-Z\.]*[a-zA-Z]+$"/>
                        </p:inputText>
                    </div>

                    <div class="p-field">
                        <p:outputLabel for="passwordE">Contraseña</p:outputLabel>
                        <p:password id="passwordE" value="#{referenceManagerBean.userBean.user.password}" feedback="true"
                                    promptLabel="Ingresa tu contraseña" weakLabel="Debil" goodLabel="Buena" strongLabel="Fuerte"/>
                        <p:staticMessage severity="info"
                                         detail="Dejar el campo vacio para mantener contraseña actual."
                                         style="width: 100%"/>
                    </div>

                    <div class="p-field">
                        <p:outputLabel for="nameE">Nombre</p:outputLabel>
                        <p:inputText id="nameE" value="#{referenceManagerBean.userBean.user.name}" required="true">
                            <f:validateRegex pattern="[a-zA-Z áéíóúüñÁÉÍÓÚÜÑ]+$"/>
                        </p:inputText>
                    </div>

                    <div class="p-field">
                        <p:outputLabel for="lastNameE">Apellido</p:outputLabel>
                        <p:inputText id="lastNameE" value="#{referenceManagerBean.userBean.user.lastName}" required="true">
                            <f:validateRegex pattern="[a-zA-Z áéíóúüñÁÉÍÓÚÜÑ]+$"/>
                        </p:inputText>
                    </div>

                    <div class="p-field">
                        <p:outputLabel for="enabledE">Estado</p:outputLabel>
                        <p:selectOneRadio id="enabledE" value="#{referenceManagerBean.userBean.user.enabled}" required="true" layout="responsive" columns="2">
                            <f:selectItem itemLabel="Habilitado" itemValue="true"/>
                            <f:selectItem itemLabel="Deshabilitado" itemValue="false"/>
                        </p:selectOneRadio>
                    </div>

                    <div class="p-field">
                        <p:outputLabel for="rolesE">Roles del Usuario</p:outputLabel>
                        <p:selectManyMenu requiredMessage="Roles: Se requiere al menos un Rol" required="true"
                                          showCheckbox="true"  label="Roles" id="rolesE" value="#{referenceManagerBean.userBean.user.roles}">
                            <f:selectItem itemLabel="Administrador" itemValue="ROLE_ADMIN"/>
                            <f:selectItem itemLabel="Usuario" itemValue="ROLE_USER"/>
                            <f:selectItem itemLabel="Gerente" itemValue="ROLE_MANAGER"/>
                            <f:selectItem itemLabel="Auditor" itemValue="ROLE_AUDITOR"/>
                        </p:selectManyMenu>
                    </div>
                </p:outputPanel>
             </p:outputPanel>
             <f:facet name="footer">
                 <p:commandButton value="Guardar" icon="pi pi-check" actionListener="#{referenceManagerBean.editUser}"
                                  update="edit-user-content" process="edit-user-content @this"/>
                 <p:commandButton value="Cancelar" icon="pi pi-times" onclick="PF('editUserDialog').hide()"
                                  class="ui-button-secondary" update="edit-user-content"
                                  process="edit-user-content @this"/>
             </f:facet>
         </p:dialog>

         <input type="hidden"
                name="${_csrf.parameterName}"
                value="${_csrf.token}"/>
     </h:form>
     </ui:define>
     </ui:composition>
 </h:body>

 </html>